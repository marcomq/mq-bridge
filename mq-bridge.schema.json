{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "Map_of_Route",
  "type": "object",
  "additionalProperties": {
    "$ref": "#/$defs/Route"
  },
  "$defs": {
    "Route": {
      "description": "Defines a single message processing route from an input to an output.",
      "type": "object",
      "properties": {
        "concurrency": {
          "description": "(Optional) Number of concurrent processing tasks for this route. Defaults to 1.",
          "type": "integer",
          "format": "uint",
          "minimum": 0,
          "default": 1
        },
        "batch_size": {
          "description": "(Optional) Number of messages to process in a single batch. Defaults to 128.",
          "type": "integer",
          "format": "uint",
          "minimum": 0,
          "default": 128
        },
        "input": {
          "description": "The input/source endpoint for the route.",
          "$ref": "#/$defs/Endpoint"
        },
        "output": {
          "description": "The output/sink endpoint for the route.",
          "$ref": "#/$defs/Endpoint",
          "default": {
            "middlewares": [],
            "mode": "consume",
            "null": null
          }
        }
      },
      "additionalProperties": false,
      "required": [
        "input"
      ]
    },
    "Endpoint": {
      "description": "Represents a connection point for messages, which can be a source (input) or a sink (output).",
      "type": "object",
      "properties": {
        "middlewares": {
          "description": "(Optional) A list of middlewares to apply to the endpoint.",
          "type": "array",
          "items": {
            "$ref": "#/$defs/Middleware"
          },
          "default": []
        },
        "mode": {
          "$ref": "#/$defs/ConsumerMode",
          "default": "consume"
        }
      },
      "unevaluatedProperties": false,
      "oneOf": [
        {
          "type": "object",
          "properties": {
            "kafka": {
              "$ref": "#/$defs/KafkaEndpoint"
            }
          },
          "required": [
            "kafka"
          ]
        },
        {
          "type": "object",
          "properties": {
            "nats": {
              "$ref": "#/$defs/NatsEndpoint"
            }
          },
          "required": [
            "nats"
          ]
        },
        {
          "type": "object",
          "properties": {
            "file": {
              "type": "string"
            }
          },
          "required": [
            "file"
          ]
        },
        {
          "type": "object",
          "properties": {
            "static": {
              "type": "string"
            }
          },
          "required": [
            "static"
          ]
        },
        {
          "type": "object",
          "properties": {
            "memory": {
              "$ref": "#/$defs/MemoryConfig"
            }
          },
          "required": [
            "memory"
          ]
        },
        {
          "type": "object",
          "properties": {
            "amqp": {
              "$ref": "#/$defs/AmqpEndpoint"
            }
          },
          "required": [
            "amqp"
          ]
        },
        {
          "type": "object",
          "properties": {
            "mongodb": {
              "$ref": "#/$defs/MongoDbEndpoint"
            }
          },
          "required": [
            "mongodb"
          ]
        },
        {
          "type": "object",
          "properties": {
            "mqtt": {
              "$ref": "#/$defs/MqttEndpoint"
            }
          },
          "required": [
            "mqtt"
          ]
        },
        {
          "type": "object",
          "properties": {
            "http": {
              "$ref": "#/$defs/HttpEndpoint"
            }
          },
          "required": [
            "http"
          ]
        },
        {
          "type": "object",
          "properties": {
            "fanout": {
              "type": "array",
              "items": {
                "$ref": "#/$defs/Endpoint"
              }
            }
          },
          "required": [
            "fanout"
          ]
        },
        {
          "type": "object",
          "properties": {
            "switch": {
              "$ref": "#/$defs/SwitchConfig"
            }
          },
          "required": [
            "switch"
          ]
        },
        {
          "type": "object",
          "properties": {
            "null": {
              "type": "null"
            }
          },
          "required": [
            "null"
          ]
        }
      ]
    },
    "Middleware": {
      "description": "An enumeration of all supported middleware types.",
      "oneOf": [
        {
          "type": "object",
          "properties": {
            "deduplication": {
              "$ref": "#/$defs/DeduplicationMiddleware"
            }
          },
          "required": [
            "deduplication"
          ],
          "additionalProperties": false
        },
        {
          "type": "object",
          "properties": {
            "metrics": {
              "$ref": "#/$defs/MetricsMiddleware"
            }
          },
          "required": [
            "metrics"
          ],
          "additionalProperties": false
        },
        {
          "type": "object",
          "properties": {
            "dlq": {
              "$ref": "#/$defs/DeadLetterQueueMiddleware"
            }
          },
          "required": [
            "dlq"
          ],
          "additionalProperties": false
        },
        {
          "type": "object",
          "properties": {
            "retry": {
              "$ref": "#/$defs/RetryMiddleware"
            }
          },
          "required": [
            "retry"
          ],
          "additionalProperties": false
        },
        {
          "type": "object",
          "properties": {
            "random_panic": {
              "$ref": "#/$defs/RandomPanicMiddleware"
            }
          },
          "required": [
            "random_panic"
          ],
          "additionalProperties": false
        }
      ]
    },
    "DeduplicationMiddleware": {
      "description": "Deduplication middleware configuration.",
      "type": "object",
      "properties": {
        "sled_path": {
          "type": "string"
        },
        "ttl_seconds": {
          "type": "integer",
          "format": "uint64",
          "minimum": 0
        }
      },
      "additionalProperties": false,
      "required": [
        "sled_path",
        "ttl_seconds"
      ]
    },
    "MetricsMiddleware": {
      "description": "Metrics middleware configuration. It's currently a struct without fields\nbut can be extended later. Its presence in the config enables the middleware.",
      "type": "object",
      "additionalProperties": false
    },
    "DeadLetterQueueMiddleware": {
      "description": "Dead-Letter Queue (DLQ) middleware configuration.",
      "type": "object",
      "properties": {
        "endpoint": {
          "$ref": "#/$defs/Endpoint"
        },
        "dlq_retry_attempts": {
          "description": "Number of retry attempts for the DLQ send. Defaults to 3.",
          "type": "integer",
          "format": "uint",
          "minimum": 0,
          "default": 3
        },
        "dlq_initial_interval_ms": {
          "type": "integer",
          "format": "uint64",
          "minimum": 0,
          "default": 100
        },
        "dlq_max_interval_ms": {
          "type": "integer",
          "format": "uint64",
          "minimum": 0,
          "default": 5000
        },
        "dlq_multiplier": {
          "type": "number",
          "format": "double",
          "default": 2.0
        }
      },
      "additionalProperties": false,
      "required": [
        "endpoint"
      ]
    },
    "RetryMiddleware": {
      "type": "object",
      "properties": {
        "max_attempts": {
          "type": "integer",
          "format": "uint",
          "minimum": 0,
          "default": 3
        },
        "initial_interval_ms": {
          "type": "integer",
          "format": "uint64",
          "minimum": 0,
          "default": 100
        },
        "max_interval_ms": {
          "type": "integer",
          "format": "uint64",
          "minimum": 0,
          "default": 5000
        },
        "multiplier": {
          "type": "number",
          "format": "double",
          "default": 2.0
        }
      },
      "additionalProperties": false
    },
    "RandomPanicMiddleware": {
      "type": "object",
      "properties": {
        "probability": {
          "type": "number",
          "format": "double"
        }
      },
      "additionalProperties": false,
      "required": [
        "probability"
      ]
    },
    "ConsumerMode": {
      "type": "string",
      "enum": [
        "consume",
        "subscribe"
      ]
    },
    "KafkaEndpoint": {
      "description": "Kafka endpoint configuration, combining connection and topic details.",
      "type": "object",
      "properties": {
        "topic": {
          "type": [
            "string",
            "null"
          ]
        },
        "url": {
          "type": "string"
        },
        "username": {
          "type": [
            "string",
            "null"
          ]
        },
        "password": {
          "type": [
            "string",
            "null"
          ]
        },
        "tls": {
          "$ref": "#/$defs/TlsConfig",
          "default": {
            "required": false,
            "ca_file": null,
            "cert_file": null,
            "key_file": null,
            "cert_password": null,
            "accept_invalid_certs": false
          }
        },
        "group_id": {
          "type": [
            "string",
            "null"
          ]
        },
        "delayed_ack": {
          "description": "If true, do not wait for an acknowledgement when sending to broker. Defaults to false.",
          "type": "boolean",
          "default": false
        },
        "producer_options": {
          "type": [
            "array",
            "null"
          ],
          "items": {
            "type": "array",
            "prefixItems": [
              {
                "type": "string"
              },
              {
                "type": "string"
              }
            ],
            "minItems": 2,
            "maxItems": 2
          },
          "default": null
        },
        "consumer_options": {
          "type": [
            "array",
            "null"
          ],
          "items": {
            "type": "array",
            "prefixItems": [
              {
                "type": "string"
              },
              {
                "type": "string"
              }
            ],
            "minItems": 2,
            "maxItems": 2
          },
          "default": null
        }
      },
      "additionalProperties": false,
      "required": [
        "url"
      ]
    },
    "TlsConfig": {
      "description": "TLS configuration for secure connections.",
      "type": "object",
      "properties": {
        "required": {
          "type": "boolean"
        },
        "ca_file": {
          "type": [
            "string",
            "null"
          ]
        },
        "cert_file": {
          "type": [
            "string",
            "null"
          ]
        },
        "key_file": {
          "type": [
            "string",
            "null"
          ]
        },
        "cert_password": {
          "type": [
            "string",
            "null"
          ]
        },
        "accept_invalid_certs": {
          "type": "boolean",
          "default": false
        }
      },
      "additionalProperties": false,
      "required": [
        "required"
      ]
    },
    "NatsEndpoint": {
      "description": "NATS endpoint configuration, combining connection and subject details.",
      "type": "object",
      "properties": {
        "subject": {
          "type": [
            "string",
            "null"
          ]
        },
        "stream": {
          "type": [
            "string",
            "null"
          ]
        },
        "url": {
          "type": "string"
        },
        "username": {
          "type": [
            "string",
            "null"
          ]
        },
        "password": {
          "type": [
            "string",
            "null"
          ]
        },
        "tls": {
          "$ref": "#/$defs/TlsConfig",
          "default": {
            "required": false,
            "ca_file": null,
            "cert_file": null,
            "key_file": null,
            "cert_password": null,
            "accept_invalid_certs": false
          }
        },
        "token": {
          "type": [
            "string",
            "null"
          ]
        },
        "delayed_ack": {
          "description": "If true, do not wait for an acknowledgement when sending to broker. Defaults to false.",
          "type": "boolean",
          "default": false
        },
        "no_jetstream": {
          "description": "If no_jetstream: true, use Core NATS (fire-and-forget) instead of JetStream. Defaults to false.",
          "type": "boolean",
          "default": false
        },
        "default_stream": {
          "type": [
            "string",
            "null"
          ]
        },
        "prefetch_count": {
          "type": [
            "integer",
            "null"
          ],
          "format": "uint",
          "minimum": 0
        }
      },
      "additionalProperties": false,
      "required": [
        "url"
      ]
    },
    "MemoryConfig": {
      "type": "object",
      "properties": {
        "topic": {
          "type": "string"
        },
        "capacity": {
          "type": [
            "integer",
            "null"
          ],
          "format": "uint",
          "minimum": 0
        }
      },
      "additionalProperties": false,
      "required": [
        "topic"
      ]
    },
    "AmqpEndpoint": {
      "description": "AMQP endpoint configuration, combining connection and queue details.",
      "type": "object",
      "properties": {
        "queue": {
          "type": [
            "string",
            "null"
          ]
        },
        "url": {
          "type": "string"
        },
        "username": {
          "type": [
            "string",
            "null"
          ]
        },
        "password": {
          "type": [
            "string",
            "null"
          ]
        },
        "tls": {
          "$ref": "#/$defs/TlsConfig",
          "default": {
            "required": false,
            "ca_file": null,
            "cert_file": null,
            "key_file": null,
            "cert_password": null,
            "accept_invalid_certs": false
          }
        },
        "exchange": {
          "type": [
            "string",
            "null"
          ]
        },
        "prefetch_count": {
          "type": [
            "integer",
            "null"
          ],
          "format": "uint16",
          "minimum": 0,
          "maximum": 65535
        },
        "no_persistence": {
          "type": "boolean",
          "default": false
        },
        "delayed_ack": {
          "description": "If true, do not wait for an acknowledgement when sending to broker. Defaults to false.",
          "type": "boolean",
          "default": false
        }
      },
      "additionalProperties": false,
      "required": [
        "url"
      ]
    },
    "MongoDbEndpoint": {
      "description": "MongoDB endpoint configuration.",
      "type": "object",
      "properties": {
        "collection": {
          "type": [
            "string",
            "null"
          ]
        },
        "url": {
          "type": "string"
        },
        "username": {
          "type": [
            "string",
            "null"
          ]
        },
        "password": {
          "type": [
            "string",
            "null"
          ]
        },
        "tls": {
          "$ref": "#/$defs/TlsConfig",
          "default": {
            "required": false,
            "ca_file": null,
            "cert_file": null,
            "key_file": null,
            "cert_password": null,
            "accept_invalid_certs": false
          }
        },
        "database": {
          "type": "string"
        },
        "polling_interval_ms": {
          "type": [
            "integer",
            "null"
          ],
          "format": "uint64",
          "minimum": 0
        },
        "ttl_seconds": {
          "type": [
            "integer",
            "null"
          ],
          "format": "uint64",
          "minimum": 0
        }
      },
      "additionalProperties": false,
      "required": [
        "url",
        "database"
      ]
    },
    "MqttEndpoint": {
      "description": "MQTT endpoint configuration.",
      "type": "object",
      "properties": {
        "topic": {
          "type": [
            "string",
            "null"
          ]
        },
        "url": {
          "type": "string"
        },
        "username": {
          "type": [
            "string",
            "null"
          ]
        },
        "password": {
          "type": [
            "string",
            "null"
          ]
        },
        "tls": {
          "$ref": "#/$defs/TlsConfig",
          "default": {
            "required": false,
            "ca_file": null,
            "cert_file": null,
            "key_file": null,
            "cert_password": null,
            "accept_invalid_certs": false
          }
        },
        "queue_capacity": {
          "type": [
            "integer",
            "null"
          ],
          "format": "uint",
          "minimum": 0
        },
        "qos": {
          "type": [
            "integer",
            "null"
          ],
          "format": "uint8",
          "minimum": 0,
          "maximum": 255
        },
        "clean_session": {
          "type": "boolean",
          "default": true
        },
        "keep_alive_seconds": {
          "type": [
            "integer",
            "null"
          ],
          "format": "uint64",
          "minimum": 0
        },
        "protocol": {
          "$ref": "#/$defs/MqttProtocol",
          "default": "v5"
        }
      },
      "additionalProperties": false,
      "required": [
        "url"
      ]
    },
    "MqttProtocol": {
      "type": "string",
      "enum": [
        "v5",
        "v3"
      ]
    },
    "HttpEndpoint": {
      "description": "HTTP endpoint configuration.",
      "type": "object",
      "properties": {
        "url": {
          "type": [
            "string",
            "null"
          ]
        },
        "tls": {
          "$ref": "#/$defs/TlsConfig",
          "default": {
            "required": false,
            "ca_file": null,
            "cert_file": null,
            "key_file": null,
            "cert_password": null,
            "accept_invalid_certs": false
          }
        },
        "response_out": {
          "anyOf": [
            {
              "$ref": "#/$defs/Endpoint"
            },
            {
              "type": "null"
            }
          ]
        }
      },
      "additionalProperties": false
    },
    "SwitchConfig": {
      "type": "object",
      "properties": {
        "metadata_key": {
          "type": "string"
        },
        "cases": {
          "type": "object",
          "additionalProperties": {
            "$ref": "#/$defs/Endpoint"
          }
        },
        "default": {
          "anyOf": [
            {
              "$ref": "#/$defs/Endpoint"
            },
            {
              "type": "null"
            }
          ]
        }
      },
      "additionalProperties": false,
      "required": [
        "metadata_key",
        "cases"
      ]
    }
  }
}